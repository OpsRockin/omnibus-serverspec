---
general:
  artifacts:
    - "pkg"
machine:
  ruby:
    version: 2.1.5
  pre:
    - echo 'DOCKER_OPTS="-s btrfs -e lxc -D --userland-proxy=false"' | sudo tee -a /etc/default/docker
    - sudo curl -L -o /usr/bin/docker 'https://s3-external-1.amazonaws.com/circle-downloads/docker-1.8.2-circleci'
    - sudo chmod 0755 /usr/bin/docker
  services:
    - docker
dependencies:
  cache_directories:
    - "~/walter"
    - "~/.omnibus_cache"
  pre:
    - bash ./ci/install-walter-1.2.0.sh
    - bash -c 'mkdir -p ~/.omnibus_cache/{ubuntu14,centos6}'
    - docker pull opsrock/omnibus_base_ubuntu14
    - docker pull opsrock/omnibus_base_centos6
    - docker build -t builder-ubuntu1404 -f docker/Dockerfile.ubuntu1404 .
    - docker build -t builder-centos6 -f docker/Dockerfile.centos6 .
    - ~/bin/walter -c ci/walter_build.yml
test:
  override:
    - rake > pkg/versions.json
