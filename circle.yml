---
general:
  artifacts:
    - "pkg"
machine:
  ruby:
    version: 2.1.5
  pre:
    - echo 'DOCKER_OPTS="-s btrfs -e lxc -D --userland-proxy=false"' | sudo tee -a /etc/default/docker
    - sudo curl -L -o /usr/bin/docker 'https://s3-external-1.amazonaws.com/circle-downloads/docker-1.8.2-circleci'
    - sudo chmod 0755 /usr/bin/docker
  services:
    - docker
dependencies:
  cache_directories:
    - "~/walter"
  pre:
    - bash ./ci/install-walter-1.2.0.sh
    - mkdir -p ~/.dockers/
    - docker pull opsrock/omnibus_base_ubuntu14
    - docker pull opsrock/omnibus_base_centos6
    - docker build -t builder-ubuntu1404 -f docker/Dockerfile.ubuntu1404 .
    - docker build -t builder-centos6 -f docker/Dockerfile.centos6 .
test:
  override:
    - "docker run  -it -e OMNIBUS_PROJECT=serverspec -e CIRCLE_BUILD_NUM -v `pwd`/pkg:/home/omnibus-project/pkg builder-ubuntu1404":
        timeout: 1200
    - "docker run  -it -e OMNIBUS_PROJECT=serverspec -e CIRCLE_BUILD_NUM -v `pwd`/pkg:/home/omnibus-project/pkg builder-centos6":
        timeout: 1200
